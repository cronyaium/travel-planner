SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for trip
-- ----------------------------
DROP TABLE IF EXISTS `trip`;
CREATE TABLE `trip`  (
                         `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
                         `trip_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT '行程名称',
                         `user_id` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
                         `trip_data_json` text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL,
                         `created_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
                         `updated_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
                         PRIMARY KEY (`id`) USING BTREE,
                         INDEX `idx_user_id`(`user_id`) USING BTREE,
                         INDEX `idx_created_time`(`created_time`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 4 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = '行程主表（JSON存储版）' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of trip
-- ----------------------------
INSERT INTO `trip` VALUES (2, '北京', '1983378338806239232', '{\"userProfile\":{\"companions\":\"独自\",\"preferences\":[\"文化\",\"美食\",\"自然风光\"]},\"tripIntent\":{\"destination\":\"北京\",\"days\":3,\"budget\":1500,\"transportMode\":\"火车\",\"season\":\"秋季\"},\"tripPlan\":[{\"day\":1,\"segments\":[{\"time\":\"上午\",\"activity\":\"抵达北京并入住酒店\",\"location\":\"前门大街附近酒店\",\"latitude\":39.897462,\"longitude\":116.397259,\"cost\":200,\"category\":\"住宿\"},{\"time\":\"中午\",\"activity\":\"品尝北京烤鸭午餐\",\"location\":\"全聚德（前门店）\",\"latitude\":39.89375,\"longitude\":116.396111,\"cost\":120,\"category\":\"餐饮\"},{\"time\":\"下午\",\"activity\":\"游览天安门广场和故宫\",\"location\":\"故宫博物院\",\"latitude\":39.916527,\"longitude\":116.397026,\"cost\":60,\"category\":\"景点\"},{\"time\":\"晚上\",\"activity\":\"夜游王府井步行街\",\"location\":\"王府井步行街\",\"latitude\":39.904211,\"longitude\":116.407395,\"cost\":50,\"category\":\"购物\"}],\"dailyTotalCost\":430},{\"day\":2,\"segments\":[{\"time\":\"上午\",\"activity\":\"游览颐和园\",\"location\":\"颐和园\",\"latitude\":39.99654,\"longitude\":116.270309,\"cost\":30,\"category\":\"景点\"},{\"time\":\"中午\",\"activity\":\"品尝老北京炸酱面\",\"location\":\"海碗居（西直门店）\",\"latitude\":39.938465,\"longitude\":116.35456,\"cost\":40,\"category\":\"餐饮\"},{\"time\":\"下午\",\"activity\":\"参观圆明园遗址\",\"location\":\"圆明园遗址公园\",\"latitude\":39.998741,\"longitude\":116.281265,\"cost\":25,\"category\":\"文化\"},{\"time\":\"晚上\",\"activity\":\"返回酒店休息\",\"location\":\"前门大街附近酒店\",\"latitude\":39.897462,\"longitude\":116.397259,\"cost\":200,\"category\":\"住宿\"}],\"dailyTotalCost\":295},{\"day\":3,\"segments\":[{\"time\":\"上午\",\"activity\":\"攀登八达岭长城\",\"location\":\"八达岭长城\",\"latitude\":40.3844,\"longitude\":116.0079,\"cost\":60,\"category\":\"景点\"},{\"time\":\"中午\",\"activity\":\"在长城脚下用餐\",\"location\":\"八达岭熊乐园餐厅\",\"latitude\":40.3822,\"longitude\":116.0055,\"cost\":50,\"category\":\"餐饮\"},{\"time\":\"下午\",\"activity\":\"返回市区并参观国家博物馆\",\"location\":\"中国国家博物馆\",\"latitude\":39.900981,\"longitude\":116.397443,\"cost\":0,\"category\":\"文化\"},{\"time\":\"晚上\",\"activity\":\"前往火车站返程\",\"location\":\"北京南站\",\"latitude\":39.86518,\"longitude\":116.37878,\"cost\":200,\"category\":\"住宿\"}],\"dailyTotalCost\":310}],\"budgetAnalysis\":{\"estimatedTotal\":1035,\"categories\":{\"交通\":0,\"住宿\":600,\"餐饮\":210,\"景点\":115,\"购物\":50,\"文化\":25},\"currency\":\"CNY\"},\"computedDailySums\":{\"day1\":430,\"day2\":295,\"day3\":310},\"computedCategorySums\":{\"交通\":0,\"住宿\":600,\"餐饮\":210,\"景点\":115,\"购物\":50,\"文化\":25},\"verification\":{\"dailyEqual\":true,\"totalEqual\":true,\"categoryEqual\":true},\"debug\":\"所有金额计算一致：每日 cost 总和等于 dailyTotalCost；dailyTotalCost 总和为 1035.00，与 estimatedTotal 一致；分类汇总与各 segment 汇总一致。住宿费用平均每天 200 元，符合预算分配逻辑。\"}', '2025-11-12 15:19:43', '2025-11-12 15:19:43');
INSERT INTO `trip` VALUES (3, '北京', '1983378338806239232', '{\"userProfile\":{\"companions\":\"独自\",\"preferences\":[\"文化\",\"美食\",\"景点\"]},\"tripIntent\":{\"destination\":\"北京\",\"days\":3,\"budget\":1500,\"transportMode\":\"火车\",\"season\":\"秋季\"},\"tripPlan\":[{\"day\":1,\"segments\":[{\"time\":\"上午\",\"activity\":\"抵达北京并入住酒店\",\"location\":\"前门大街附近酒店\",\"latitude\":39.897667,\"longitude\":116.397234,\"cost\":400,\"category\":\"住宿\"},{\"time\":\"中午\",\"activity\":\"品尝北京炸酱面\",\"location\":\"海碗居（前门店）\",\"latitude\":39.896543,\"longitude\":116.398123,\"cost\":50,\"category\":\"餐饮\"},{\"time\":\"下午\",\"activity\":\"游览天安门广场和故宫\",\"location\":\"故宫博物院\",\"latitude\":39.916667,\"longitude\":116.397026,\"cost\":60,\"category\":\"景点\"},{\"time\":\"晚上\",\"activity\":\"前门大街夜游与小吃体验\",\"location\":\"前门大街\",\"latitude\":39.897026,\"longitude\":116.398123,\"cost\":80,\"category\":\"餐饮\"}],\"dailyTotalCost\":590},{\"day\":2,\"segments\":[{\"time\":\"上午\",\"activity\":\"参观颐和园\",\"location\":\"颐和园\",\"latitude\":39.998746,\"longitude\":116.274984,\"cost\":30,\"category\":\"景点\"},{\"time\":\"中午\",\"activity\":\"品尝老北京炸灌肠与豆汁儿\",\"location\":\"护国寺小吃（西直门店）\",\"latitude\":39.940283,\"longitude\":116.374846,\"cost\":40,\"category\":\"餐饮\"},{\"time\":\"下午\",\"activity\":\"游览圆明园遗址公园\",\"location\":\"圆明园\",\"latitude\":39.996181,\"longitude\":116.282181,\"cost\":25,\"category\":\"景点\"},{\"time\":\"晚上\",\"activity\":\"返回市区晚餐并休息\",\"location\":\"全聚德烤鸭（王府井店）\",\"latitude\":39.908722,\"longitude\":116.413584,\"cost\":150,\"category\":\"餐饮\"},{\"time\":\"夜间\",\"activity\":\"续住前门附近酒店\",\"location\":\"前门大街附近酒店\",\"latitude\":39.897667,\"longitude\":116.397234,\"cost\":400,\"category\":\"住宿\"}],\"dailyTotalCost\":645},{\"day\":3,\"segments\":[{\"time\":\"上午\",\"activity\":\"攀登八达岭长城\",\"location\":\"八达岭长城\",\"latitude\":40.376252,\"longitude\":116.014456,\"cost\":60,\"category\":\"景点\"},{\"time\":\"中午\",\"activity\":\"长城脚下农家菜午餐\",\"location\":\"长城脚下的公社餐厅\",\"latitude\":40.375123,\"longitude\":116.012345,\"cost\":70,\"category\":\"餐饮\"},{\"time\":\"下午\",\"activity\":\"返回市区并自由购物\",\"location\":\"王府井步行街\",\"latitude\":39.908722,\"longitude\":116.413584,\"cost\":200,\"category\":\"购物\"},{\"time\":\"晚上\",\"activity\":\"返程前最后一餐\",\"location\":\"东来顺涮羊肉（王府井店）\",\"latitude\":39.907543,\"longitude\":116.412345,\"cost\":120,\"category\":\"餐饮\"}],\"dailyTotalCost\":450}],\"budgetAnalysis\":{\"estimatedTotal\":1685,\"categories\":{\"交通\":0,\"住宿\":800,\"餐饮\":460,\"景点\":175,\"购物\":200,\"文化\":0},\"currency\":\"CNY\"},\"computedDailySums\":{\"day1\":590,\"day2\":645,\"day3\":450},\"computedCategorySums\":{\"交通\":0,\"住宿\":800,\"餐饮\":460,\"景点\":175,\"购物\":200,\"文化\":0},\"verification\":{\"dailyEqual\":false,\"totalEqual\":false,\"categoryEqual\":false},\"debug\":\"初步计算发现总预算超出，住宿费用过高。需重新分配每日预算，将总预算控制在1500元内，并确保金额一致性。开始重新计算...\"}', '2025-11-12 15:29:52', '2025-11-12 15:29:52');

SET FOREIGN_KEY_CHECKS = 1;
